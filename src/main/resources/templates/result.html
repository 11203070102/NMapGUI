<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>NMAP WEB</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

       
    <script>
    function performPost() {
    	/*Updates output from backend*/
        var settings = {
            type: 'GET',
            url:'/nmap/update'
        };
        /*And writes it on its place*/
        $.ajax(settings).done(function(result) {
        	$('#out-fragment').html(result);
        });
    }
    
    var loop;
        
    function startLoop(){
    	
        /*Get Url to send the command*/
    	var urlvar = '/nmap-exe';

        if (document.getElementById('text').value != '') {
        	urlvar = urlvar + '?code=' + document.getElementById('text').value ;
        }
        /*Execute ajax command request*/
        var settings = {
                type: 'GET',
                url:urlvar
            };
        $.ajax(settings)
		/*Stops any current output refreshing and starts live feed from console*/
        if(loop!=null)
        	clearInterval(loop);
    	loop=window.setInterval(performPost, 1000);
    }
    
    
	</script>
</head>
<body>
	<h1>Post your command</h1>
    <form th:object="${command}" onsubmit="startLoop(); return false;">
        <p>Command: nmap<input type="text" th:field="*{text}" /></p>
        <p><input type="submit" value="Submit"/> <input type="reset" value="Reset" /></p>
    </form>
    
    <h2>Result</h2>
    <div id="out-fragment" th:fragment="out-fragment">
    	<p th:text="'Executed command: nmap ' + ${command.text}"></p>    
	    <p th:utext="${output.text}"></p>
	    
    </div>
    
    

</body>
</html>